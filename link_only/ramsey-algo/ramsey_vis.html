<script>
function point_coords(graph_size,node_num){
    var xcen = 300;
    var height = 300;
    var radial_offset = (2*Math.PI*(node_num + 0.2))/graph_size;
    var radial_size = 100*Math.sqrt(graph_size);
    var pointcen = [xcen+radial_size*Math.cos(radial_offset),height+radial_size*Math.sin(radial_offset)];
    return pointcen
}
function draw_line(start,end,color){
    ctx.beginPath();
    ctx.moveTo(start[0],start[1]);
    ctx.lineTo(end[0],end[1]);
    if(color == 1){
        ctx.strokeStyle = 'red';
    }
    else if (color == -1){
        ctx.strokeStyle = 'blue';
    }
    else{
        console.log("color problem")
    }
    ctx.stroke();
}
function draw_circ(cen){
    var rad = 10;
    ctx.beginPath();
    ctx.arc(cen[0],cen[1],rad,0,2*Math.PI);
    ctx.fill();
}
function draw_circles(graph_size){
    ctx.strokeStyle = 'black';
    for(var i = 0; i < graph_size; i++){
        draw_circ(point_coords(graph_size,i));
    }
}
function draw_edges(graph_size,coloring){
    for(var y = 0; y < graph_size; y++){
        for(var x = 0; x < y; x++){
            color = coloring[y][x]
            draw_line(point_coords(graph_size,x),point_coords(graph_size,y),color);
        }
    }
}
function draw_graph(coloring,graph_size){
    ctx.clearRect(0, 0, c.width, c.height);
    draw_circles(graph_size);
    draw_edges(graph_size,coloring);
}
function random_color(){
    return 2*Math.floor(Math.random() * 2) - 1;
}
function rand_coloring(size){
    matrix = new Array(size)
    for(var i = 0; i < size; i++){
        matrix[i] = new Array(size)
        for(var j = 0; j < i; j++){
            matrix[i][j] = random_color();
            matrix[j][i] = matrix[i][j];
        }
        matrix[i][i] = 0;
    }
    return matrix
}
function copy_2d_array(vals,size){
    copy = new Array(size)
    for(var i = 0; i < size; i++){
        copy[i] = vals[i].slice(0)
    }
    return copy
}
function update_vals(cur_vals, edges, size){
    new_vals = copy_2d_array(cur_vals,size)
    for(var i = 0; i < size; i++){
        for(var j = 0; j < size; j++){
            if(j == i){
                continue;
            }
            if(edges[i][j] == 1){
                for(var k = 0; k < size; k++){
                    var cv = cur_vals[j][k];
                    if(cv > 0){
                        new_vals[i][k] += cv;
                    }
                }
            }
            else if(edges[i][j] == -1){
                for(var k = 0; k < size; k++){
                    var cv = cur_vals[j][k];
                    if(cv < 0){
                        new_vals[i][k] += cv;
                    }
                }
            }
            else{
                console.log("bad edge");
            }
        }
    }
    return new_vals
}
function greatest_mag_edge(vals,size){
    var max_mag = -1;
    var max_edge = [0,0]
    for(var i = 0; i < size; i++){
        for(var j = 0; j < size; j++){
            if(j == i){
                continue;
            }
            var mag = Math.abs(vals[i][j]);
            if(mag > max_mag){
                max_mag = mag
                max_edge = [i,j]
            }
        }
    }
    return max_edge
}
function change_edge(edges, edge){
    console.log(edge)
    var x = edge[0]
    var y = edge[1]
    if(edges[x][y] != edges[y][x]){
        console.log("something is wrong!")
    }
    var old_weight = edges[x][y];
    edges[x][y] = -old_weight
    edges[y][x] = -old_weight
}
function find_best_flip_edge(edges,size){
    var start_vals = copy_2d_array(edges,size)
    console.log(start_vals)
    for(var i = 0; i < 4; i++){
        start_vals = update_vals(start_vals,edges,size)
        console.log(start_vals)
    }
    return greatest_mag_edge(start_vals,size)
}
function update_graph(edges,size){
    var edge = find_best_flip_edge(edges,size)
    change_edge(edges,edge)
    draw_graph(edges,size)
}
function draw_new_graph(){
    update_graph(coloring, my_size)
}
</script>
<body>
<button onclick="draw_new_graph()">Update Graph</button>
<canvas id="myCanvas" width="1000" height="1000">
</canvas>
</body>
<script>
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
var my_size = 16;
var coloring = rand_coloring(my_size)
draw_graph(coloring,my_size)

</script>
